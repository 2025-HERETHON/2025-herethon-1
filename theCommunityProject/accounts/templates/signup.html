<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <script>
        // 아이디 중복 확인 함수
        function checkUsername() {
            const username = document.querySelector('input[name="username"]').value;

            if (!username) {
                alert("아이디를 입력해주세요.");
                return;
            }

            fetch(`/accounts/check_username/?username=${username}`)
                .then(response => response.json())
                .then(data => {
                    if (data.is_taken) {
                        alert("이미 사용 중인 아이디입니다.");
                    } else {
                        alert("사용 가능한 아이디입니다.");
                    }
                })
                .catch(error => {
                    alert("오류가 발생했습니다.");
                    console.error(error);
                });
        }
    </script>
</head>

<body>
    <h2>회원가입</h2>
    {% if error_message %} <!-- 에러 메시지가 있다면 출력 -->
        <p style="color: red;">{{ error_message }}</p>  
    {% endif %}
    <form method="POST">
        {% csrf_token %}
        <label>아이디:</label>
        <input type="text" name="username">
        <button type="button" onclick="checkUsername()">중복 확인</button><br>

        <label>비밀번호:</label>
        <input type="password" name="password"><br>

        <label>비밀번호 확인:</label>
        <input type="password" name="repeat"><br>

        <label>성별:</label>
        <select name="sex">
            <option value="M">남성</option>
            <option value="F">여성</option>
            <option value="N">선택 안함</option>
        </select><br>

        <label>출생년도:</label>
        <input type="number" name="birth_year" min="1910" max="2010"><br>

        <button type="submit">가입하기</button>
    </form>
</body>
</html>