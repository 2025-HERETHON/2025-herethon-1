<!DOCTYPE html>
{% load static %}
{% load extra_dict %}
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ post.title }} - ë” ì»¤ë®¤ë‹ˆí‹°</title>
  <style>
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    .card {
      background-color: #1f1f1f;
      padding: 1rem;
      border-radius: 10px;
      color: white;
      transition: transform 0.2s ease;
    }
    .article-thumbnail {
      width: 120px;
      height: 120px;
      border-radius: 8px;
      background-color: #ccc;
      object-fit: cover;
    }
  </style>
</head>
<body>

{% if messages %}
  <div>
    {% for message in messages %}
      <p style="color:red;">{{ message }}</p>
    {% endfor %}
  </div>
{% endif %}

<a href="{% url 'community:detail' post.id %}">â† ê²Œì‹œ\uuae00 ë³´ê¸°</a>

<form id="voteForm" method="post" action="{% url 'community:detail_vote' post.id now %}">
  {% csrf_token %}
  <label><input type="radio" name="selected" value="1" {% if voted_choice == 1 %}checked{% endif %} {% if voted_choice %}disabled{% endif %}> {{ post.option1 }}</label><br>
  <label><input type="radio" name="selected" value="2" {% if voted_choice == 2 %}checked{% endif %} {% if voted_choice %}disabled{% endif %}> {{ post.option2 }}</label><br>
  <label><input type="radio" name="selected" value="3" {% if voted_choice == 3 %}checked{% endif %} {% if voted_choice %}disabled{% endif %}> {{ post.option3 }}</label><br>
  <button type="submit">íˆ¬í‘œí•˜ê¸°</button>
</form>

<hr>
<div style="display:flex; justify-content:space-between; align-items:center;">
  <div>ğŸ’¬ {{ comments.count }}</div>
  <div>
    {% if request.user in post.scrapped.all %}
      <a style="color: #a57bff;" href="{% url 'community:detail_post_scrap' post.id now %}">ìŠ¤í¬ë˜í”„</a>
    {% else %}
      <a style="color: #000;" href="{% url 'community:detail_post_scrap' post.id now %}">ìŠ¤í¬ë˜í”„</a>
    {% endif %}
  </div>
  <div><button onclick="copyCurrentUrl()">ê³µìœ </button></div>
</div>
<hr>

<script>
function copyCurrentUrl() {
  const url = window.location.href;
  navigator.clipboard.writeText(url);
  alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
}
</script>

<h3>ëŒ“ê¸€ {{ comments|length }}ê°œ</h3>

<h2>ì˜ê²¬</h2>
<div style="margin-bottom: 1rem;">
  <span>ì…ì¥ë³„ í•„í„°: </span>
  <a href="?filter=all" {% if not request.GET.filter or request.GET.filter == 'all' %}style="font-weight:bold;"{% endif %}>ì „ì²´</a> |
  <a href="?filter=1" {% if request.GET.filter == '1' %}style="font-weight:bold;"{% endif %}>ì°¬ì„±</a> |
  <a href="?filter=2" {% if request.GET.filter == '2' %}style="font-weight:bold;"{% endif %}>ë°˜ëŒ€</a> |
  <a href="?filter=3" {% if request.GET.filter == '3' %}style="font-weight:bold;"{% endif %}>ì¤‘ë¦½</a>
</div>

{% comment %}
ëŒ“ê¸€ í•„í„°ë§ ì¡°ê±´ì„ ì •ë¦¬í•œ ë¸”ë¡ì…ë‹ˆë‹¤.
ê¸°ì¡´ elseê°€ ëˆ„ë½ëœ ìœ„ì¹˜ì— ìˆì—ˆê³ , filter=allì— ëŒ€í•œ ì²˜ë¦¬ ì¡°ê±´ì´ ì¤‘ì²© if/else ë¬¸ë²• ë•Œë¬¸ì— ì‘ë™ ì•ˆí–ˆì„ ìˆ˜ ìˆìŒ
{% endcomment %}

{% with selected_stance=request.GET.filter|default:'all' %}
  {% if selected_stance == 'all' %}
    {% include '_comment_list.html' with comments=comments %}
  {% elif comments_by_choice|dict_get:selected_stance %}
    {% include '_comment_list.html' with comments=comments_by_choice|dict_get:selected_stance %}
  {% else %}
    <p>ì•„ì§ ì˜ê²¬ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endif %}
{% endwith %}

<h3>ëŒ“ê¸€ ì‘ì„±</h3>
<form method="post" id="comment-form" action="{% url 'community:detail_comment_create' post.id now %}">
  {% csrf_token %}
  <textarea name="content">{{ comment_form.content.value|default_if_none:'' }}</textarea>
  <button type="submit" id="submit-comment">ëŒ“ê¸€ ì‘ì„±</button>
  <button type="button" id="ai-button">AI</button>
</form>

<script>
document.getElementById('ai-button').addEventListener('click', function() {
  const form = document.getElementById('comment-form');
  form.action = "{% url 'community:detail_comment_ai_response' post.id now %}";
  form.submit();
  form.action = "{% url 'community:detail_comment_create' post.id now %}";
});
</script>

{% if commentEvidence %}
  <div id="aiResult" style="background:#333; color:#eee; padding:10px; margin-top:10px; border-radius:8px;">
    <div style="font-weight:bold; margin-bottom:6px;">result</div>
    <div style="background:#555; padding:10px; border-radius:4px;">
      ìë£Œ ê²€ìƒ‰ ê²°ê³¼<br>
      AI ì£¼ì„<br>
      {{ commentEvidence.keyword }}<br>
      <a href="{{ commentEvidence.link1 }}" target="_blank" style="color:#9cf;">ì¶œì²˜ ë§í¬</a>
      <a href="{{ commentEvidence.link2 }}" target="_blank" style="color:#9cf;">ì¶œì²˜ ë§í¬</a>
    </div>
  </div>
{% endif %}

<h3>ê´€ë ¨ ì•„í‹°í´</h3>
{% if post.related_article %}
  <a href="{% url 'articles:detail' post.related_article.id %}" class="card-link">
    <div class="card">
      <div class="article-thumbnail">
        <img src="{{ post.related_article.image.url }}" alt="ìŒŒë”ë‚¨ì¼" style="width: 100%;">
      </div>
      <div class="card-content">{{ post.related_article.title|truncatechars:30 }}</div>
      <div class="meta">â¤ï¸ {{ post.related_article.liked.count }} | ğŸ’¬ {{ post.related_article.article_comments.count }}</div>
    </div>
  </a>
{% else %}
  <p style="color: #999;">ì´ ê²Œì‹œë¬¼ê³¼ ì—°ê²°ëœ ì•„í‹°í´ì´ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}

<hr>

<h3>ìµœê·œ ì¶”ì²œ ì•„í‹°í´</h3>
<section class="grid">
  {% for article in recommended_articles %}
    <a href="{% url 'articles:detail' article.id %}" class="card-link">
      <div class="card">
        <div class="article-thumbnail">
          <img src="{{ article.image }}" alt="ìŒŒë”ë‚¨ì¼" style="width: 100%;">
        </div>
        <div class="card-content">{{ article.title|truncatechars:30 }}</div>
        <div class="meta">â¤ï¸ {{ article.liked.count }} | ğŸ’¬ {{ article.article_comments.count }}</div>
      </div>
    </a>
  {% empty %}
    <p style="color: #999;">ì¶”ì²œ ì•„í‹°í´ì´ ì—†ìŠµë‹ˆë‹¤.</p>
  {% endfor %}
</section>

<a href="{% url 'community:detail_comment_detail' post.id %}">ëŒ“ê¸€ ìƒì„¸</a>

</body>
</html>
