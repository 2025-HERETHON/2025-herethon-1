<div class="comment-reply-group" style="width: 63rem">
  {% load extra_dict %}
    <div id="comment-list">
      {% for comment in comments %}
      <div class="comment-reply-card" id="comment_{{ comment.id }}">
        <div class="comment-top">
          <div class="profile">
            <img src="{{ comment.image.url }}" />
            <div class="nickname">{{ comment.anonymous_name }}</div>
            <div class="gender">{% if comment.user.sex == 'M' %}남성{% elif comment.user.sex == 'F' %}여성{% else %}기타{% endif %}</div>
            <div class="time">{{comment.created_at|date:"Y.m.d"}}</div>
          </div>
          {% if request.user == comment.user %}
          <form
            method="post"
            action="{% url 'community:detail_comment_delete' post.id comment.id now %}"
            style="display: inline"
          >
            {% csrf_token %}
            <div class="icon-buttons1 comment-menu" style="cursor: pointer">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="18"
                height="18"
                viewBox="0 0 18 18"
                fill="none"
              >
                <mask
                  id="mask0_1256_5409"
                  style="mask-type: alpha"
                  maskUnits="userSpaceOnUse"
                  x="0"
                  y="0"
                  width="18"
                  height="18"
                >
                  <rect width="18" height="18" fill="#D9D9D9" />
                </mask>
                <g mask="url(#mask0_1256_5409)">
                  <path
                    d="M9.00005 15C8.65958 15 8.36815 14.8787 8.12576 14.6362C7.88323 14.3938 7.76196 14.1024 7.76196 13.7619C7.76196 13.4214 7.88323 13.1299 8.12576 12.8874C8.36815 12.645 8.65958 12.5238 9.00005 12.5238C9.34053 12.5238 9.63196 12.645 9.87435 12.8874C10.1169 13.1299 10.2381 13.4214 10.2381 13.7619C10.2381 14.1024 10.1169 14.3938 9.87435 14.6362C9.63196 14.8787 9.34053 15 9.00005 15ZM9.00005 10.2381C8.65958 10.2381 8.36815 10.1168 8.12576 9.8743C7.88323 9.63191 7.76196 9.34048 7.76196 9C7.76196 8.65952 7.88323 8.36809 8.12576 8.1257C8.36815 7.88317 8.65958 7.76191 9.00005 7.76191C9.34053 7.76191 9.63196 7.88317 9.87435 8.1257C10.1169 8.36809 10.2381 8.65952 10.2381 9C10.2381 9.34048 10.1169 9.63191 9.87435 9.8743C9.63196 10.1168 9.34053 10.2381 9.00005 10.2381ZM9.00005 5.47618C8.65958 5.47618 8.36815 5.35499 8.12576 5.1126C7.88323 4.87007 7.76196 4.57857 7.76196 4.23809C7.76196 3.89762 7.88323 3.60618 8.12576 3.36379C8.36815 3.12126 8.65958 3 9.00005 3C9.34053 3 9.63196 3.12126 9.87435 3.36379C10.1169 3.60618 10.2381 3.89762 10.2381 4.23809C10.2381 4.57857 10.1169 4.87007 9.87435 5.1126C9.63196 5.35499 9.34053 5.47618 9.00005 5.47618Z"
                    fill="#A3A3A3"
                  />
                </g>
              </svg>
              <div class="delete-menu hidden">
                <button type="submit" class="delete-btn" style="cursor: pointer">
                  삭제하기
                </button>
              </div>
            </div>
          </form>
          {% endif %}
        </div>
        <div class="text">
          <div class="comment-place">{{ comment.content }}</div>
        </div>
        <div class="comment-bottom">
          <div class="comment-div4">
            <div class="comment-buttons2 like">
              {% if request.user in comment.liked.all %}
              <a
                style="color: #a57bff"
                href="{% url 'community:detail_comment_like' post.id comment.id now %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                >
                  <mask
                    id="mask0_1422_14738"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="16"
                    height="17"
                  >
                    <rect y="0.00585938" width="16" height="16" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_1422_14738)">
                    <path
                      d="M13.272 5.73969C13.578 5.73969 13.8484 5.85707 14.0831 6.09184C14.3178 6.3265 14.4352 6.59687 14.4352 6.90295V7.94235C14.4352 8.00992 14.4265 8.08231 14.4092 8.15953C14.3919 8.23664 14.3725 8.30866 14.3511 8.37558L12.5068 12.7272C12.4147 12.933 12.2602 13.1068 12.0432 13.2487C11.8262 13.3906 11.5998 13.4616 11.364 13.4616H4.59723V5.73969L8.34057 2.02852C8.46852 1.90068 8.61663 1.82437 8.7849 1.7996C8.95317 1.77483 9.11442 1.80368 9.26864 1.88615C9.42297 1.96873 9.53601 2.0859 9.60776 2.23766C9.67951 2.38941 9.69479 2.54658 9.65361 2.70917L8.96057 5.73969H13.272ZM5.56246 6.15055V12.4963H11.3663C11.4116 12.4963 11.458 12.4839 11.5054 12.4592C11.5529 12.4344 11.5891 12.3932 11.6138 12.3355L13.47 7.9919V6.90295C13.47 6.84515 13.4514 6.79769 13.4143 6.76058C13.3772 6.72347 13.3298 6.70492 13.272 6.70492H7.74052L8.54729 3.17812L5.56246 6.15055ZM2.7287 13.4616C2.40878 13.4616 2.13492 13.3477 1.90712 13.1199C1.67933 12.8921 1.56543 12.6182 1.56543 12.2983V6.90295C1.56543 6.58303 1.67933 6.30917 1.90712 6.08138C2.13492 5.85358 2.40878 5.73969 2.7287 5.73969H4.59723V6.70492H2.7287C2.67089 6.70492 2.62343 6.72347 2.58633 6.76058C2.54922 6.79769 2.53066 6.84515 2.53066 6.90295V12.2983C2.53066 12.3561 2.54922 12.4036 2.58633 12.4407C2.62343 12.4778 2.67089 12.4963 2.7287 12.4963H4.59723V13.4616H2.7287Z"
                      fill="#AD97F6"
                    />
                  </g>
                </svg>
                {{ comment.liked.count }}
              </a>
              {% else %}
              <a
                style="color: #fff"
                href="{% url 'community:detail_comment_like' post.id comment.id now %}"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="17"
                  height="16"
                  viewBox="0 0 17 16"
                  fill="none"
                >
                  <mask
                    id="mask0_1422_14733"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="17"
                    height="17"
                  >
                    <rect
                      x="0.826172"
                      y="0.00585938"
                      width="16"
                      height="16"
                      fill="#D9D9D9"
                    />
                  </mask>
                  <g mask="url(#mask0_1422_14733)">
                    <path
                      d="M14.0981 5.73969C14.4042 5.73969 14.6746 5.85707 14.9092 6.09184C15.144 6.3265 15.2614 6.59687 15.2614 6.90295V7.94235C15.2614 8.00992 15.2527 8.08231 15.2353 8.15953C15.2181 8.23664 15.1987 8.30866 15.1773 8.37558L13.333 12.7272C13.2409 12.933 13.0863 13.1068 12.8694 13.2487C12.6524 13.3906 12.426 13.4616 12.1902 13.4616H5.4234V5.73969L9.16674 2.02852C9.29469 1.90068 9.4428 1.82437 9.61107 1.7996C9.77934 1.77483 9.94059 1.80368 10.0948 1.88615C10.2491 1.96873 10.3622 2.0859 10.4339 2.23766C10.5057 2.38941 10.521 2.54658 10.4798 2.70917L9.78674 5.73969H14.0981ZM6.38864 6.15055V12.4963H12.1924C12.2378 12.4963 12.2842 12.4839 12.3316 12.4592C12.3791 12.4344 12.4152 12.3932 12.44 12.3355L14.2962 7.9919V6.90295C14.2962 6.84515 14.2776 6.79769 14.2405 6.76058C14.2034 6.72347 14.1559 6.70492 14.0981 6.70492H8.56669L9.37346 3.17812L6.38864 6.15055ZM3.55487 13.4616C3.23495 13.4616 2.96109 13.3477 2.73329 13.1199C2.5055 12.8921 2.3916 12.6182 2.3916 12.2983V6.90295C2.3916 6.58303 2.5055 6.30917 2.73329 6.08138C2.96109 5.85358 3.23495 5.73969 3.55487 5.73969H5.4234V6.70492H3.55487C3.49706 6.70492 3.44961 6.72347 3.4125 6.76058C3.37539 6.79769 3.35684 6.84515 3.35684 6.90295V12.2983C3.35684 12.3561 3.37539 12.4036 3.4125 12.4407C3.44961 12.4778 3.49706 12.4963 3.55487 12.4963H5.4234V13.4616H3.55487Z"
                      fill="#A3A3A3"
                    />
                  </g>
                </svg>
                {{ comment.liked.count }}
              </a>
              {% endif %}
            </div>
            <button
            type="button"
              class="comment-buttons2 message"
              onclick="toggleReply({{ comment.id }})"
              style="border: none; background-color: transparent"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
              >
                <mask
                  id="mask0_1256_2863"
                  style="mask-type: alpha"
                  maskUnits="userSpaceOnUse"
                  x="0"
                  y="0"
                  width="16"
                  height="16"
                >
                  <rect width="16" height="16" fill="#D9D9D9" />
                </mask>
                <g mask="url(#mask0_1256_2863)">
                  <path
                    d="M3.46453 12.8406L1.94142 14.3635C1.72497 14.5801 1.476 14.6292 1.19451 14.5107C0.913144 14.3922 0.772461 14.1788 0.772461 13.8705V2.80404C0.772461 2.41971 0.9056 2.09441 1.17188 1.82813C1.43816 1.56185 1.76346 1.42871 2.14779 1.42871H13.8522C14.2365 1.42871 14.5618 1.56185 14.8281 1.82813C15.0944 2.09441 15.2275 2.41971 15.2275 2.80404V11.4653C15.2275 11.8496 15.0944 12.1749 14.8281 12.4412C14.5618 12.7075 14.2365 12.8406 13.8522 12.8406H3.46453ZM2.97876 11.6994H13.8522C13.9108 11.6994 13.9644 11.675 14.0131 11.6262C14.0619 11.5775 14.0863 11.5239 14.0863 11.4653V2.80404C14.0863 2.74545 14.0619 2.69182 14.0131 2.64313C13.9644 2.59431 13.9108 2.5699 13.8522 2.5699H2.14779C2.0892 2.5699 2.03557 2.59431 1.98688 2.64313C1.93806 2.69182 1.91365 2.74545 1.91365 2.80404V12.7529L2.97876 11.6994Z"
                    fill="#A3A3A3"
                  />
                </g>
              </svg>
              <div class="comment-div3">{{ comment.filtered_replies.count }}</div>
            </button>
          </div>
          <button
          type="button"
            class="comment-buttons2 reply"
            onclick="toggleReply({{ comment.id }})"
            style="border: none; background-color: transparent"
          >
            <div class="comment-div3" style="cursor: pointer">답글 달기</div>
          </button>
        </div>
      </div>


    {% if opened_reply_comment_id|stringformat:"s" == comment.id|stringformat:"s" %}
        <div id="reply-section-{{ comment.id }}" style="display:block;" >
      {% for reply in comment.replies.all %}
        {% if reply.created_at %}
      <div class="comment-reply-card comment-background"
          style="border-radius: 0"
          id="reply_{{ reply.id }}">
          <div
            class="comment-top"
            style="display: flex; justify-content: space-between"
          >
            <div class="profile">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="28"
                  viewBox="0 0 24 28"
                  fill="none"
                >
                  <mask
                    id="mask0_1422_4971"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="24"
                    height="28"
                  >
                    <rect width="24" height="28" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_1422_4971)">
                    <path
                      d="M13.1936 19.7629C13.0344 19.6047 12.9563 19.4239 12.9596 19.2207C12.9628 19.0174 13.0409 18.8399 13.1936 18.6881L16.4349 15.4721H6.85778C6.34531 15.4721 5.90752 15.292 5.54441 14.9319C5.18147 14.5716 5 14.1372 5 13.6287V4.76481C5 4.54777 5.07382 4.36609 5.22146 4.21975C5.36893 4.07325 5.55203 4 5.77076 4C5.98948 4 6.17258 4.07325 6.32005 4.21975C6.46769 4.36609 6.54151 4.54777 6.54151 4.76481V13.6287C6.54151 13.7203 6.57114 13.7955 6.6304 13.8543C6.68967 13.9131 6.76546 13.9425 6.85778 13.9425H16.4349L13.178 10.7107C13.0185 10.5524 12.9414 10.3733 12.9467 10.1733C12.9521 9.97339 13.0291 9.79434 13.178 9.63611C13.3374 9.47788 13.5196 9.39783 13.7244 9.39596C13.9293 9.39392 14.1081 9.46871 14.2609 9.62031L18.7372 14.062C18.8334 14.1576 18.9013 14.2583 18.9407 14.3641C18.9802 14.47 19 14.5844 19 14.7073C19 14.8302 18.9802 14.9445 18.9407 15.0504C18.9013 15.1563 18.8334 15.257 18.7372 15.3525L14.2925 19.7629C14.133 19.921 13.9499 20 13.7432 20C13.5363 20 13.3531 19.921 13.1936 19.7629Z"
                      fill="#737373"
                    />
                  </g>
                </svg>
                <img src="{{ reply.image.url }}" />
                <div class="nickname">{{ reply.anonymous_name }}</div>
                <div class="gender">
                  {% if reply.user.sex == 'M' %}남성{% elif reply.user.sex == 'F' %}여성{% else %}기타{% endif %}
                </div>
                <div class="time">{{reply.created_at|date:"Y.m.d"}}</div>
            </div>
            {% if request.user == comment.user %}
            <form
              method="post"
              action="{% url 'community:detail_reply_delete' post.id comment.id reply.id %}"
              style="display: inline"
            >
              {% csrf_token %}
              <div class="icon-buttons1 comment-menu" style="cursor: pointer">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none"
                >
                  <mask
                    id="mask0_1256_5409"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="18"
                    height="18"
                  >
                    <rect width="18" height="18" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_1256_5409)">
                    <path
                      d="M9.00005 15C8.65958 15 8.36815 14.8787 8.12576 14.6362C7.88323 14.3938 7.76196 14.1024 7.76196 13.7619C7.76196 13.4214 7.88323 13.1299 8.12576 12.8874C8.36815 12.645 8.65958 12.5238 9.00005 12.5238C9.34053 12.5238 9.63196 12.645 9.87435 12.8874C10.1169 13.1299 10.2381 13.4214 10.2381 13.7619C10.2381 14.1024 10.1169 14.3938 9.87435 14.6362C9.63196 14.8787 9.34053 15 9.00005 15ZM9.00005 10.2381C8.65958 10.2381 8.36815 10.1168 8.12576 9.8743C7.88323 9.63191 7.76196 9.34048 7.76196 9C7.76196 8.65952 7.88323 8.36809 8.12576 8.1257C8.36815 7.88317 8.65958 7.76191 9.00005 7.76191C9.34053 7.76191 9.63196 7.88317 9.87435 8.1257C10.1169 8.36809 10.2381 8.65952 10.2381 9C10.2381 9.34048 10.1169 9.63191 9.87435 9.8743C9.63196 10.1168 9.34053 10.2381 9.00005 10.2381ZM9.00005 5.47618C8.65958 5.47618 8.36815 5.35499 8.12576 5.1126C7.88323 4.87007 7.76196 4.57857 7.76196 4.23809C7.76196 3.89762 7.88323 3.60618 8.12576 3.36379C8.36815 3.12126 8.65958 3 9.00005 3C9.34053 3 9.63196 3.12126 9.87435 3.36379C10.1169 3.60618 10.2381 3.89762 10.2381 4.23809C10.2381 4.57857 10.1169 4.87007 9.87435 5.1126C9.63196 5.35499 9.34053 5.47618 9.00005 5.47618Z"
                      fill="#A3A3A3"
                    />
                  </g>
                </svg>
                <div class="delete-menu hidden">
                  <button type="submit" class="delete-btn" style="cursor: pointer">
                    삭제하기
                  </button>
                </div>
              </div>
            </form>
            {% endif %}
          </div>
        <div class="text" style="padding-top: 0.3rem; margin-left: 1.5rem">
            <div class="comment-place">{{ reply.content }}</div>
        </div>
        <div class="comment-bottom">
            <div class="comment-div4">
              <div class="comment-buttons2 like">
              {% if request.user in reply.liked.all %}
              <a style="color: #a57bff" href="{% url 'community:detail_reply_like' post.id reply.comment.id reply.id %}">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 16 16"
                  fill="none"
                >
                  <mask
                    id="mask0_1422_14738"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="16"
                    height="17"
                  >
                    <rect y="0.00585938" width="16" height="16" fill="#D9D9D9" />
                  </mask>
                  <g mask="url(#mask0_1422_14738)">
                    <path
                      d="M13.272 5.73969C13.578 5.73969 13.8484 5.85707 14.0831 6.09184C14.3178 6.3265 14.4352 6.59687 14.4352 6.90295V7.94235C14.4352 8.00992 14.4265 8.08231 14.4092 8.15953C14.3919 8.23664 14.3725 8.30866 14.3511 8.37558L12.5068 12.7272C12.4147 12.933 12.2602 13.1068 12.0432 13.2487C11.8262 13.3906 11.5998 13.4616 11.364 13.4616H4.59723V5.73969L8.34057 2.02852C8.46852 1.90068 8.61663 1.82437 8.7849 1.7996C8.95317 1.77483 9.11442 1.80368 9.26864 1.88615C9.42297 1.96873 9.53601 2.0859 9.60776 2.23766C9.67951 2.38941 9.69479 2.54658 9.65361 2.70917L8.96057 5.73969H13.272ZM5.56246 6.15055V12.4963H11.3663C11.4116 12.4963 11.458 12.4839 11.5054 12.4592C11.5529 12.4344 11.5891 12.3932 11.6138 12.3355L13.47 7.9919V6.90295C13.47 6.84515 13.4514 6.79769 13.4143 6.76058C13.3772 6.72347 13.3298 6.70492 13.272 6.70492H7.74052L8.54729 3.17812L5.56246 6.15055ZM2.7287 13.4616C2.40878 13.4616 2.13492 13.3477 1.90712 13.1199C1.67933 12.8921 1.56543 12.6182 1.56543 12.2983V6.90295C1.56543 6.58303 1.67933 6.30917 1.90712 6.08138C2.13492 5.85358 2.40878 5.73969 2.7287 5.73969H4.59723V6.70492H2.7287C2.67089 6.70492 2.62343 6.72347 2.58633 6.76058C2.54922 6.79769 2.53066 6.84515 2.53066 6.90295V12.2983C2.53066 12.3561 2.54922 12.4036 2.58633 12.4407C2.62343 12.4778 2.67089 12.4963 2.7287 12.4963H4.59723V13.4616H2.7287Z"
                      fill="#AD97F6"
                    />
                  </g>
                </svg>
                {{ reply.liked.count }}
              </a>
              {% else %}
              <a style="color: #fff" href="{% url 'community:detail_reply_like' post.id reply.comment.id reply.id %}">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="17"
                  height="16"
                  viewBox="0 0 17 16"
                  fill="none"
                >
                  <mask
                    id="mask0_1422_14733"
                    style="mask-type: alpha"
                    maskUnits="userSpaceOnUse"
                    x="0"
                    y="0"
                    width="17"
                    height="17"
                  >
                    <rect
                      x="0.826172"
                      y="0.00585938"
                      width="16"
                      height="16"
                      fill="#D9D9D9"
                    />
                  </mask>
                  <g mask="url(#mask0_1422_14733)">
                    <path
                      d="M14.0981 5.73969C14.4042 5.73969 14.6746 5.85707 14.9092 6.09184C15.144 6.3265 15.2614 6.59687 15.2614 6.90295V7.94235C15.2614 8.00992 15.2527 8.08231 15.2353 8.15953C15.2181 8.23664 15.1987 8.30866 15.1773 8.37558L13.333 12.7272C13.2409 12.933 13.0863 13.1068 12.8694 13.2487C12.6524 13.3906 12.426 13.4616 12.1902 13.4616H5.4234V5.73969L9.16674 2.02852C9.29469 1.90068 9.4428 1.82437 9.61107 1.7996C9.77934 1.77483 9.94059 1.80368 10.0948 1.88615C10.2491 1.96873 10.3622 2.0859 10.4339 2.23766C10.5057 2.38941 10.521 2.54658 10.4798 2.70917L9.78674 5.73969H14.0981ZM6.38864 6.15055V12.4963H12.1924C12.2378 12.4963 12.2842 12.4839 12.3316 12.4592C12.3791 12.4344 12.4152 12.3932 12.44 12.3355L14.2962 7.9919V6.90295C14.2962 6.84515 14.2776 6.79769 14.2405 6.76058C14.2034 6.72347 14.1559 6.70492 14.0981 6.70492H8.56669L9.37346 3.17812L6.38864 6.15055ZM3.55487 13.4616C3.23495 13.4616 2.96109 13.3477 2.73329 13.1199C2.5055 12.8921 2.3916 12.6182 2.3916 12.2983V6.90295C2.3916 6.58303 2.5055 6.30917 2.73329 6.08138C2.96109 5.85358 3.23495 5.73969 3.55487 5.73969H5.4234V6.70492H3.55487C3.49706 6.70492 3.44961 6.72347 3.4125 6.76058C3.37539 6.79769 3.35684 6.84515 3.35684 6.90295V12.2983C3.35684 12.3561 3.37539 12.4036 3.4125 12.4407C3.44961 12.4778 3.49706 12.4963 3.55487 12.4963H5.4234V13.4616H3.55487Z"
                      fill="#A3A3A3"
                    />
                  </g>
                </svg>
                {{ reply.liked.count }}
              </a>
              {% endif %}
              </div>
            </div>
        </div>
      </div>
      {% endif %}
      {% empty %}
      <p>대댓글이 없습니다.</p>
      {% endfor %}

  <div class="comment-reply-inputfield">
    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16" fill="none">
<path d="M8.19364 15.7629C8.03435 15.6047 7.95634 15.4239 7.95959 15.2207C7.96284 15.0174 8.04086 14.8399 8.19364 14.6881L11.4349 11.4721H1.85778C1.34531 11.4721 0.907522 11.292 0.54441 10.9319C0.18147 10.5716 0 10.1372 0 9.62866V0.764806C0 0.547771 0.0738211 0.366087 0.221464 0.219754C0.368935 0.0732513 0.552032 0 0.770755 0C0.989479 0 1.17258 0.0732513 1.32005 0.219754C1.46769 0.366087 1.54151 0.547771 1.54151 0.764806V9.62866C1.54151 9.72026 1.57114 9.79547 1.6304 9.85427C1.68967 9.91308 1.76546 9.94248 1.85778 9.94248H11.4349L8.17797 6.71066C8.01851 6.55243 7.94143 6.3733 7.94674 6.17326C7.95205 5.97339 8.02913 5.79434 8.17797 5.63611C8.33743 5.47788 8.51959 5.39783 8.72444 5.39596C8.92929 5.39392 9.1081 5.46871 9.26088 5.62031L13.7372 10.062C13.8334 10.1576 13.9013 10.2583 13.9407 10.3641C13.9802 10.47 14 10.5844 14 10.7073C14 10.8302 13.9802 10.9445 13.9407 11.0504C13.9013 11.1563 13.8334 11.257 13.7372 11.3525L9.29248 15.7629C9.13302 15.921 8.94993 16 8.74319 16C8.53629 16 8.3531 15.921 8.19364 15.7629Z" fill="#737373"/>
    </svg>
    <div class="comment-inputfield-div">
      <form method="post" id="reply-form-{{ comment.id }}" action="{% url 'community:detail_reply_create' comment.post.id comment.id %}">
      {% csrf_token %}
      <!-- 필터 값과 열린 답글 comment_id 같이 넘기기 -->
      <input type="hidden" name="filter" value="{{ request.GET.filter|default:'all' }}">
      <input type="hidden" name="opened_reply_comment_id" value="{{ comment.id }}">
        <div class="comment-inputfield" style="width: 57rem">
          <div class="name" style="vertical-align: middle">
            <div class="inputprofilSVG" style="margin-right: 0.25rem">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                  >
                    <g clip-path="url(#clip0_509_2310)">
                      <mask id="path-1-inside-1_509_2310" fill="white">
                        <path
                          d="M0 10C0 4.47715 4.47715 0 10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20C4.47715 20 0 15.5228 0 10Z"
                        />
                      </mask>
                      <path
                        d="M0 10C0 4.47715 4.47715 0 10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20C4.47715 20 0 15.5228 0 10Z"
                        fill="#FAFAFA"
                      />
                      <circle cx="10" cy="8.125" r="3.75" fill="#D4D4D4" />
                      <path
                        d="M16.9442 18.0558C16.9442 21.891 13.8351 25 9.99997 25C6.1648 25 3.05579 21.891 3.05579 18.0558C3.05579 14.2207 6.1648 12.5 9.99997 12.5C13.8351 12.5 16.9442 14.2207 16.9442 18.0558Z"
                        fill="#D4D4D4"
                      />
                    </g>
                    <path
                      d="M10 20V19C5.02944 19 1 14.9706 1 10H0H-1C-1 16.0751 3.92487 21 10 21V20ZM20 10H19C19 14.9706 14.9706 19 10 19V20V21C16.0751 21 21 16.0751 21 10H20ZM10 0V1C14.9706 1 19 5.02944 19 10H20H21C21 3.92487 16.0751 -1 10 -1V0ZM10 0V-1C3.92487 -1 -1 3.92487 -1 10H0H1C1 5.02944 5.02944 1 10 1V0Z"
                      fill="#FAFAFA"
                      mask="url(#path-1-inside-1_509_2310)"
                    />
                    <defs>
                      <clipPath id="clip0_509_2310">
                        <path
                          d="M0 10C0 4.47715 4.47715 0 10 0C15.5228 0 20 4.47715 20 10C20 15.5228 15.5228 20 10 20C4.47715 20 0 15.5228 0 10Z"
                          fill="white"
                        />
                      </clipPath>
                    </defs>
                  </svg>
            </div>
            <div class="nickname" style="margin-top: -0.13rem">익명</div>
          </div>
          {% if opened_reply_comment_id|stringformat:"s" == comment.id|stringformat:"s" %}

          <textarea name="content"
            class="inputplace"
            style="width: 57rem; background-color:transparent"
            placeholder="답글을 입력하세요."
          >{{ reply_form.content.value|default_if_none:'' }}</textarea>
          {% else %}
          <textarea name="content"
            class="inputplace"
            style="width: 57rem; background-color:transparent"
            placeholder="답글을 입력하세요."
          >{{ reply_form.content.value|default_if_none:'' }}</textarea>
          {% endif %}
          <div class="inputplace-menu">
                <button
                  type="button"
                  onclick="ReplyAiBtn(this)"
                  id="ai-button-reply-{{ comment.id }}"
                  class="ai-btn"
                  data-post-id="{{ post.id }}"
                  data-comment-id="{{ comment.id }}"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="18"
                    height="18"
                    viewBox="0 0 18 18"
                    fill="none"
                  >
                    <mask
                      id="mask0_711_8826"
                      style="mask-type: alpha"
                      maskUnits="userSpaceOnUse"
                      x="0"
                      y="0"
                      width="18"
                      height="18"
                    >
                      <rect width="18" height="18" fill="#D9D9D9" />
                    </mask>
                    <g mask="url(#mask0_711_8826)">
                      <path
                        d="M2.10581 14.25H15.8942C16.0658 14.25 16.2097 14.3081 16.3258 14.4242C16.4419 14.5403 16.5 14.6842 16.5 14.8558C16.5 15.0274 16.4419 15.1713 16.3258 15.2874C16.2097 15.4034 16.0658 15.4614 15.8942 15.4614H2.10581C1.93419 15.4614 1.79031 15.4034 1.67419 15.2874C1.55806 15.1713 1.5 15.0274 1.5 14.8558C1.5 14.6842 1.55806 14.5403 1.67419 14.4242C1.79031 14.3081 1.93419 14.25 2.10581 14.25ZM14.25 12.3028V3.07219C14.25 2.94294 14.2922 2.83613 14.3766 2.75175C14.4609 2.66725 14.5677 2.625 14.6968 2.625C14.8258 2.625 14.9326 2.66725 15.0173 2.75175C15.1019 2.83613 15.1442 2.94294 15.1442 3.07219V12.3028C15.1442 12.4321 15.102 12.5389 15.0176 12.6233C14.9333 12.7078 14.8265 12.75 14.6974 12.75C14.5684 12.75 14.4616 12.7078 14.3769 12.6233C14.2923 12.5389 14.25 12.4321 14.25 12.3028ZM5.63794 10.0429L4.75388 12.3577C4.70575 12.4846 4.63025 12.5817 4.52738 12.6491C4.4245 12.7164 4.30737 12.75 4.176 12.75C3.96025 12.75 3.79087 12.6606 3.66787 12.4817C3.54475 12.3029 3.52119 12.1121 3.59719 11.9093L7.08469 3.01444C7.12794 2.89719 7.201 2.80294 7.30387 2.73169C7.40688 2.66056 7.51844 2.625 7.63856 2.625H8.10975C8.24075 2.625 8.35531 2.66056 8.45344 2.73169C8.55144 2.80294 8.62206 2.89719 8.66531 3.01444L12.1571 11.8991C12.2331 12.1068 12.2075 12.3005 12.0803 12.4804C11.9531 12.6601 11.7812 12.75 11.5644 12.75C11.4348 12.75 11.3144 12.7128 11.2033 12.6384C11.0923 12.5641 11.0136 12.4618 10.9672 12.3317L10.1136 10.0429H5.63794ZM6.04031 8.925H9.68794L7.89094 4.2H7.84463L6.04031 8.925Z"
                        fill="#A3A3A3"
                      />
                    </g>
                  </svg>
                </button>
                <div class="button-stack">
                  <div class="delete-button1">취소</div>
                  <button
                    type="submit"
                    id="submit-comment"
                    class="button2 submit"
                  >
                    등록
                  </button>
                </div>
          </div>
        </div>
      </form>

      {% if replyEvidenceMap|dict_get1:comment.id %}
      <div class="ai-evidence-section ai-search ai-result">
      <div class="ai-result-css">
        <div class="ai-result-top">
          <div class="title">자료 검색 결과</div>
          <div class="close">닫기</div>
        </div>

<!--        <div class="ai">AI 주석</div>-->
        {% for evidence in replyEvidenceMap|dict_get:comment.id %}
        <div class="ai-text">
          {{ replyEvidence.keyword|linebreaksbr }}
          <div style="display: flex; vertical-align: middle">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                  >
                    <g clip-path="url(#clip0_1256_3835)">
                      <mask
                        id="mask0_1256_3835"
                        style="mask-type: alpha"
                        maskUnits="userSpaceOnUse"
                        x="-2"
                        y="-2"
                        width="24"
                        height="24"
                      >
                        <rect
                          x="-2"
                          y="-2"
                          width="24"
                          height="24"
                          fill="#D9D9D9"
                        />
                      </mask>
                      <g mask="url(#mask0_1256_3835)">
                        <path
                          d="M8.83214 10.585C9.08293 10.9203 9.40289 11.1977 9.77031 11.3985C10.1377 11.5992 10.544 11.7186 10.9617 11.7485C11.3793 11.7784 11.7985 11.7182 12.1907 11.5718C12.583 11.4255 12.9393 11.1965 13.2353 10.9004L14.9872 9.14848C15.519 8.59779 15.8133 7.86023 15.8067 7.09466C15.8 6.32909 15.493 5.59676 14.9516 5.0554C14.4102 4.51403 13.6779 4.20696 12.9123 4.20031C12.1468 4.19365 11.4092 4.48796 10.8585 5.01983L9.85408 6.01841M11.168 9.41711C10.9172 9.08183 10.5973 8.80442 10.2298 8.60367C9.86241 8.40293 9.45611 8.28356 9.03849 8.25365C8.62087 8.22374 8.2017 8.28399 7.80941 8.43033C7.41713 8.57666 7.0609 8.80565 6.7649 9.10176L5.01299 10.8537C4.48112 11.4044 4.18682 12.1419 4.19347 12.9075C4.20012 13.6731 4.5072 14.4054 5.04856 14.9468C5.58992 15.4881 6.32225 15.7952 7.08783 15.8018C7.8534 15.8085 8.59096 15.5142 9.14164 14.9823L10.1402 13.9837"
                          stroke="#737373"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </g>
                    </g>
                    <defs>
                      <clipPath id="clip0_1256_3835">
                        <rect width="20" height="20" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  <a
                    href="{{ evidence.link1 }}"
                    target="_blank"
                    class="ai-link"
                    >출처 링크</a
                  >
          </div>
          <div style="display: flex; vertical-align: middle">
            <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 20 20"
                    fill="none"
                  >
                    <g clip-path="url(#clip0_1256_3835)">
                      <mask
                        id="mask0_1256_3835"
                        style="mask-type: alpha"
                        maskUnits="userSpaceOnUse"
                        x="-2"
                        y="-2"
                        width="24"
                        height="24"
                      >
                        <rect
                          x="-2"
                          y="-2"
                          width="24"
                          height="24"
                          fill="#D9D9D9"
                        />
                      </mask>
                      <g mask="url(#mask0_1256_3835)">
                        <path
                          d="M8.83214 10.585C9.08293 10.9203 9.40289 11.1977 9.77031 11.3985C10.1377 11.5992 10.544 11.7186 10.9617 11.7485C11.3793 11.7784 11.7985 11.7182 12.1907 11.5718C12.583 11.4255 12.9393 11.1965 13.2353 10.9004L14.9872 9.14848C15.519 8.59779 15.8133 7.86023 15.8067 7.09466C15.8 6.32909 15.493 5.59676 14.9516 5.0554C14.4102 4.51403 13.6779 4.20696 12.9123 4.20031C12.1468 4.19365 11.4092 4.48796 10.8585 5.01983L9.85408 6.01841M11.168 9.41711C10.9172 9.08183 10.5973 8.80442 10.2298 8.60367C9.86241 8.40293 9.45611 8.28356 9.03849 8.25365C8.62087 8.22374 8.2017 8.28399 7.80941 8.43033C7.41713 8.57666 7.0609 8.80565 6.7649 9.10176L5.01299 10.8537C4.48112 11.4044 4.18682 12.1419 4.19347 12.9075C4.20012 13.6731 4.5072 14.4054 5.04856 14.9468C5.58992 15.4881 6.32225 15.7952 7.08783 15.8018C7.8534 15.8085 8.59096 15.5142 9.14164 14.9823L10.1402 13.9837"
                          stroke="#737373"
                          stroke-width="1.5"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                        />
                      </g>
                    </g>
                    <defs>
                      <clipPath id="clip0_1256_3835">
                        <rect width="20" height="20" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  <a
                    href="{{ evidence.link2 }}"
                    target="_blank"
                    class="ai-link"
                    >출처 링크</a
                  >
          </div>
        </div>
        {% endfor %}
      </div>
      </div>
      {% endif %}
    </div>
  </div>
          </div>
      {% else %}
      <div id="reply-section-{{ comment.id }}" style="display:none;"></div>
      {% endif %}
    {% empty %}
    <p>아직 의견이 없습니다.</p>
    {% endfor %}

    </div></div>
<script>
  function ReplyAiBtn(button) {
    const postId = button.dataset.postId;
  const commentId = button.dataset.commentId;

  const form = button.closest("form");

  form.action = `/community/${postId}/detail/comment/${commentId}/reply/evidence/`;
  form.submit();

  }

function toggleReply(commentId) {
  const url = new URL(window.location.href);
  const currentId = url.searchParams.get("opened_reply_comment_id");

  if (currentId === String(commentId)) {
    // 이미 열려 있는 경우 → 파라미터 제거하여 닫기
    url.searchParams.delete("opened_reply_comment_id");
  } else {
    // 새로 열기
    url.searchParams.set("opened_reply_comment_id", commentId);
  }

  window.location.href = url.toString();
}
  document.addEventListener("click", (event) => {
  // 클릭한 요소 중에서 ⋯ 버튼(.comment-menu)을 포함한 경우
  const menuBtn = event.target.closest(".icon-buttons1.comment-menu");
  if (menuBtn) {
    const deleteMenu = menuBtn.querySelector(".delete-menu");
    if (deleteMenu) {
      // toggle 보이기/숨기기
      deleteMenu.classList.toggle("hidden");
    }
    // 더 이상 다른 클릭 이벤트로 넘어가지 않게 중단
    event.stopPropagation();
    return;
  }
});
</script>
