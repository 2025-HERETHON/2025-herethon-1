<!DOCTYPE html>
{% load static %}
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>{{ post.title }} - ì •ì±… ì œì•ˆ</title>
  <style>
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 10px;
      width: 400px;
      color: black;
    }
    .modal-content textarea {
      width: 100%;
      height: 60px;
      margin-bottom: 10px;
    }
    .modal-content h3 {
      margin-top: 0;
    }
    .modal.show {
      display: flex;
    }
  </style>
</head>
<body>
<a href="{% url 'proposals:home' %}">â† ì •ì±… ì œì•ˆ í™ˆìœ¼ë¡œ</a>
<h2>{{ post.title }}ì— ëŒ€í•˜ì—¬ ìƒˆë¡œìš´ ì •ì±…ì„ ì œì•ˆí•´ ì£¼ì„¸ìš”</h2>
<hr>

<h3>íˆ¬í‘œ ê²°ê³¼</h3>
<p>Q. {{ post.question }}</p>
<p>ê²°ê³¼: {{ post.result_choice }} ({{ post.result_percent }}%)</p>
<p>
  <a href="{% url 'community:detail' post.community_post.id %}">
    {{ post.community_post.title }}
  </a>
</p>
<p>
  ë¼ëŠ” ë…¼ì œì— ëŒ€í•œ êµ­ë¯¼ íˆ¬í‘œ ê²°ê³¼, <strong>{{ post.result_choice }}</strong>ëŠ” ì˜ê²¬ì´ ë‹¤ìˆ˜ë¥¼ ì°¨ì§€í•˜ë©° ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
</p>

<div style="display:flex; justify-content:space-between; align-items:center;">
  <div><a href="{% url 'proposals:detail_post_like' post.id %}">â¤ï¸ {{ post.liked.count }}</a></div>
  <div>ğŸ’¬ {{ post.proposal_comments.count }}</div>
  <div>
    {% if request.user in post.scrapped.all %}
    <a style="color: #a57bff;" href="{% url 'proposals:detail_post_scrap' post.id %}">ìŠ¤í¬ë©</a>
    {% else %}
    <a style="color: #000;" href="{% url 'proposals:detail_post_scrap' post.id %}">ìŠ¤í¬ë©</a>
    {% endif %}
  </div>
</div>

<hr>
<!-- ì •ì±… ì œì•ˆ ë²„íŠ¼ -->
<button onclick="openModal()">ì •ì±… ì œì•ˆí•˜ê¸°</button>

<!-- ëª¨ë‹¬ íŒì—… í¼ -->
<div id="proposalModal" class="modal">
  <div class="modal-content">
    <h3>ì •ì±… ì œì•ˆí•˜ê¸°</h3>
    <form method="post" action="{% url 'proposals:detail_comment_create' post.id %}">
      {% csrf_token %}
      <label>ì œì•ˆ ì œëª©</label><br>
      <textarea name="title" required></textarea><br>
      <label>í˜„í™© ë° ë¬¸ì œì </label><br>
      <textarea name="problem" required></textarea><br>
      <label>ê°œì„  ë°©ì•ˆ</label><br>
      <textarea name="solution" required></textarea><br>
      <label>ê¸°ëŒ€ íš¨ê³¼</label><br>
      <textarea name="effect" required></textarea><br>
      <button type="submit">ì œì•ˆí•˜ê¸°</button>
      <button type="button" onclick="closeModal()">ë‹«ê¸°</button>
    </form>
  </div>
</div>

<hr>
<h3>ì œì•ˆ ({{ post.proposal_comments.count }}ê±´)</h3>
{% for comment in post.proposal_comments.all %}
  <div id="comment_{{ comment.id }}" style="border-top:1px solid #000; padding:10px 0;">
    <strong>{{ comment.user.username }}:</strong><br>
    <p><strong>{{ comment.title }}</strong></p>
    <p><b>í˜„í™© ë° ë¬¸ì œì :</b> {{ comment.problem }}</p>
    <p><b>ê°œì„  ë°©ì•ˆ:</b> {{ comment.solution }}</p>
    <p><b>ê¸°ëŒ€ íš¨ê³¼:</b> {{ comment.effect }}</p>

    <p>
      {{ comment.created_at|date:"Y-m-d H:i" }}
      <button onclick="toggleReply({{ comment.id }})">ğŸ’¬ ëŒ€ëŒ“ê¸€ ({{ comment.proposal_replies.count }})</button>
      <a href="{% url 'proposals:detail_comment_like' post.id comment.id %}">â¤ï¸ {{ comment.liked.count }}</a>
      
    </p>

    <div id="reply-section-{{ comment.id }}" style="display:none;">
      {% for reply in comment.proposal_replies.all %}
        <div id="reply_{{ reply.id }}">
          <strong>{{ reply.user.username }}{% if reply.user == comment.user %} (ê¸€ì“´ì´){% endif %}</strong>
          <p>{{ reply.content }}</p>
          <small>{{ reply.created_at|date:"Y-m-d H:i" }}</small>
          <a href="{% url 'proposals:detail_reply_like' post.id comment.id reply.id %}">â¤ï¸ {{ reply.liked.count }}</a>
        </div>
      {% empty %}
        <p>ëŒ€ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
      {% endfor %}

      <form method="post" action="{% url 'proposals:detail_reply_create' post.id comment.id %}">
        {% csrf_token %}
        <textarea name="content" placeholder="ëŒ€ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." style="width:100%; height:60px;"></textarea><br>
        <button type="submit">ë“±ë¡</button>
      </form>
    </div>
  </div>
{% empty %}
  <p>ì•„ì§ ì œì•ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
{% endfor %}

<script>
  function toggleReply(commentId) {
    const el = document.getElementById('reply-section-' + commentId);
    el.style.display = el.style.display === 'block' ? 'none' : 'block';
  }

  function openModal() {
    document.getElementById('proposalModal').classList.add('show');
  }

  function closeModal() {
    document.getElementById('proposalModal').classList.remove('show');
  }
</script>
</body>
</html>
